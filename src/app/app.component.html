<div class="shell">
  <div class="topbar">
    <div>
      <div class="brand">Datapulse</div>
      <div class="subtitle">Inventory Fact</div>
    </div>

    <div style="display:flex; gap:10px; align-items:center;">
      <span *ngIf="auth.authenticated" class="mono">
        {{ auth.userInfo?.email || auth.userInfo?.user || 'user' }}
      </span>

      <button *ngIf="!auth.authenticated" (click)="login()">Login</button>
      <button *ngIf="!auth.authenticated" (click)="register()">Register</button>

      <button *ngIf="auth.authenticated" (click)="logout()">Logout</button>

      <button (click)="load()" [disabled]="loading || !auth.authenticated">
        {{ loading ? 'Loading…' : 'Reload' }}
      </button>
    </div>
  </div>

  <!-- ===== Not Authenticated ===== -->
  <div class="card" *ngIf="!auth.authenticated">
    <div class="error" style="margin:0;">
      Not authenticated. Please Login or Register.
    </div>

    <div style="display:flex; gap:10px; margin-top:12px;">
      <button (click)="login()">Login</button>
      <button (click)="register()">Register</button>
    </div>
  </div>

  <!-- ===== Authenticated Content ===== -->
  <div class="card" *ngIf="auth.authenticated">
    <div class="filters">
      <label>Account
        <input type="number" [(ngModel)]="accountId">
      </label>

      <label>Marketplace
        <select [(ngModel)]="marketplace">
          <option value="">all</option>
          <option value="OZON">OZON</option>
          <option value="WILDBERRIES">WILDBERRIES</option>
        </select>
      </label>

      <label>From
        <input type="date" [(ngModel)]="fromDate">
      </label>

      <label>To
        <input type="date" [(ngModel)]="toDate">
      </label>

      <label>Warehouse
        <input type="number" [(ngModel)]="warehouseId">
      </label>

      <label>Product
        <input type="text" [(ngModel)]="sourceProductId">
      </label>

      <label>Limit
        <input type="number" [(ngModel)]="limit">
      </label>

      <button class="primary" (click)="load()" [disabled]="loading">
        {{ loading ? 'Loading…' : 'Apply' }}
      </button>
    </div>

    <div class="error" *ngIf="error">{{ error }}</div>

    <div class="table-wrap" *ngIf="rows.length">
      <table>
        <thead>
        <tr>
          <th>ID</th>
          <th>snapshotDate</th>
          <th>platform</th>
          <th>product</th>
          <th>warehouse</th>
          <th>total</th>
          <th>available</th>
          <th>reserved</th>
          <th>→ client</th>
          <th>← client</th>
          <th>ret to seller</th>
          <th>ret from cust</th>
          <th>price</th>
          <th>discount</th>
          <th>created</th>
          <th>updated</th>
        </tr>
        </thead>

        <tbody>
        <tr *ngFor="let r of rows">
          <td class="mono">{{ r.id }}</td>
          <td class="mono">{{ r.snapshotDate }}</td>
          <td>{{ r.sourcePlatform }}</td>
          <td class="mono">{{ r.sourceProductId }}</td>
          <td class="mono">{{ r.warehouseId }}</td>

          <td class="mono">{{ r.quantityTotal }}</td>
          <td class="mono">{{ r.quantityAvailable }}</td>
          <td class="mono">{{ r.quantityReserved }}</td>
          <td class="mono">{{ r.quantityInWayToClient }}</td>
          <td class="mono">{{ r.quantityInWayFromClient }}</td>
          <td class="mono">{{ r.quantityReturnToSeller }}</td>
          <td class="mono">{{ r.quantityReturnFromCustomer }}</td>

          <td class="mono">{{ r.price }}</td>
          <td class="mono">{{ r.discount }}</td>
          <td class="mono">{{ r.createdAt }}</td>
          <td class="mono">{{ r.updatedAt }}</td>
        </tr>
        </tbody>
      </table>
    </div>

    <div *ngIf="!loading && !rows.length && !error">
      No inventory data
    </div>
  </div>
</div>
