<header class="app-header">
  <div class="app-header__inner app-container">
    <a class="brand-link" [routerLink]="homePath" aria-label="Datapulse — на главную">
      <img class="brand-icon" src="assets/logo.svg" alt="DataPulse"/>
    </a>

    <div class="app-header__profile" *ngIf="userProfile$ | async as profile; else loginTemplate">
      <div class="profile-menu">
        <button
          type="button"
          class="profile-trigger"
          (click)="toggleMenu()"
          [attr.aria-expanded]="isMenuOpen"
          aria-haspopup="menu"
        >
          <span class="profile-avatar" aria-hidden="true">
            {{ getInitial(profile) }}
          </span>

          <span class="profile-trigger__name">
            {{ profile.fullName || profile.username || profile.email || profile.keycloakSub }}
          </span>

          <span class="profile-menu__caret" aria-hidden="true">▾</span>
        </button>

        <div
          class="profile-menu__backdrop"
          *ngIf="isMenuOpen"
          (click)="closeMenu()"
        ></div>

        <div class="profile-menu__panel" *ngIf="isMenuOpen" role="menu">
          <div class="profile-menu__panel-content">
            <a
              class="profile-menu__item"
              [routerLink]="profilePath"
              (click)="closeMenu()"
              role="menuitem"
            >
              <span class="profile-menu__item-title">Profile</span>
            </a>

            <a
              class="profile-menu__item"
              *ngIf="currentWorkspaceTree as tree"
              [routerLink]="workspacesPath"
              (click)="closeMenu()"
              role="menuitem"
            >
              <span class="profile-menu__item-title">Workspaces</span>

            </a>

            <div class="profile-menu__divider" role="separator" aria-hidden="true"></div>

            <button
              type="button"
              class="profile-menu__item profile-menu__item--danger"
              (click)="logout(); closeMenu()"
              [disabled]="isLogoutRedirecting"
              role="menuitem"
            >
              <span class="profile-menu__item-title">Logout</span>
            </button>
          </div>
        </div>
      </div>
    </div>

    <ng-template #loginTemplate>
      <div class="app-header__profile">
        <dp-button
          type="button"
          variant="secondary"
          (click)="login()"
          [disabled]="isLoginRedirecting"
        >
          Войти
        </dp-button>
      </div>
    </ng-template>
  </div>
</header>
