<ng-container *ngIf="vm$ | async as vm">
  <dp-dashboard-shell
    [accountId]="vm.accountId"
    title="Users & Access"
    subtitle="Команда и уровни доступа"
  >
    <div class="page">
      <div class="controls-row">
        <p class="muted">Участники текущего workspace и их роли.</p>
        <dp-button type="button" variant="secondary" (click)="refresh()">Refresh</dp-button>
      </div>

      <section class="table-card">
        <div class="table-header">
          <div>
            <h3>Members</h3>
            <p class="muted">Управляйте доступом и ролями участников.</p>
          </div>
        </div>

        <div *ngIf="vm.state.status === 'loading'">
          <dp-loader label="Загружаем участников..."></dp-loader>
        </div>

        <div class="error-text" *ngIf="vm.state.status === 'error'">
          {{ vm.state.error.message }}
        </div>

        <ng-container *ngIf="vm.state.status === 'ready'">
          <dp-operators-table
            *ngIf="vm.state.data.members.length > 0; else emptyState"
            [operators]="vm.state.data.members"
            (updateMember)="updateMember($event)"
            (deleteMember)="deleteMember($event)"
          ></dp-operators-table>
          <ng-template #emptyState>
            <div class="empty-state">
              <p class="muted">Участников пока нет.</p>
            </div>
          </ng-template>
        </ng-container>
      </section>
    </div>
  </dp-dashboard-shell>
</ng-container>
