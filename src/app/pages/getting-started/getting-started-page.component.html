<div class="getting-started-page" *ngIf="flowState as flow">
  <div class="getting-started-shell" [class.is-flow-locked]="flow.isLocked">
    <dp-page-header
      title="Getting started"
      subtitle="Создайте workspace, подключите данные и запустите первую синхронизацию."
    ></dp-page-header>

    <div
      class="status-line"
      [class.is-active]="isStatusActive"
      [class.is-error]="statusState === 'error'"
    >
      <span class="status-dot"></span>
      <div>
        <div>{{ statusText }}</div>
        <div class="status-meta" *ngIf="statusHint">{{ statusHint }}</div>
      </div>
    </div>

    <div class="steps" role="list">
      <div
        class="step"
        role="listitem"
        *ngFor="let step of flow.steps; let index = index"
        [class.is-complete]="step.status === 'done'"
        [class.is-active]="step.status === 'active'"
        [class.is-skipped]="step.status === 'skipped'"
      >
        <div class="step__index">{{ index + 1 }}</div>

        <div class="step__content">
          <div class="step__title">
            {{ step.label }}
            <span class="step__optional" *ngIf="step.optional">Optional</span>
          </div>
          <div class="step__description">{{ step.description }}</div>
        </div>

        <div class="step__actions">
          <dp-button
            *ngIf="step.action"
            [variant]="step.action.variant"
            type="button"
            (click)="handleAction(step.action)"
            [disabled]="step.action.disabled ?? false"
          >
            {{ step.action.label }}
          </dp-button>

          <dp-button
            *ngIf="step.secondaryAction"
            [variant]="step.secondaryAction.variant"
            type="button"
            (click)="handleAction(step.secondaryAction)"
            [disabled]="step.secondaryAction.disabled ?? false"
          >
            {{ step.secondaryAction.label }}
          </dp-button>
        </div>
      </div>
    </div>

    <dp-error-state *ngIf="syncError" title="Sync failed" [description]="syncError.message">
      <dp-button variant="secondary" type="button" (click)="startSync()">
        Retry
      </dp-button>
    </dp-error-state>
  </div>

  <dp-modal [visible]="accountModalVisible" (close)="closeAccountModal()">
    <div class="modal-content">
      <h3>Create workspace</h3>

      <dp-account-form [disabled]="formLocked"></dp-account-form>

      <div class="modal-actions">
        <dp-button variant="secondary" type="button" (click)="closeAccountModal()">
          Cancel
        </dp-button>
        <dp-button
          variant="primary"
          type="button"
          (click)="createAccount()"
          [disabled]="isProcessing"
        >
          Create
        </dp-button>
      </div>
    </div>
  </dp-modal>

  <dp-modal [visible]="connectionModalVisible" (close)="closeConnectionModal()">
    <div class="modal-content">
      <h3>Create connection</h3>

      <dp-connection-form
        [disabled]="formLocked"
        [errorMessage]="tokenErrorMessage"
      ></dp-connection-form>

      <div class="modal-actions">
        <dp-button variant="secondary" type="button" (click)="closeConnectionModal()">
          Cancel
        </dp-button>
        <dp-button
          variant="primary"
          type="button"
          (click)="createConnection()"
          [disabled]="isProcessing"
        >
          Create
        </dp-button>
      </div>
    </div>
  </dp-modal>

  <dp-invite-member-modal
    [visible]="inviteModalVisible"
    [saving]="inviteSaving"
    [existingMembers]="existingMembers"
    (close)="closeInviteModal()"
    (submitInvite)="submitInvite($event)"
  ></dp-invite-member-modal>
</div>
